# Конвертор данных из PostgreSQL в PostgreSQL

Модуль для конвертации данных из одной базы данных PostgreSQL в другую с использованием Python и psycopg2.

## Установка

1. Установите зависимости:
```
pip install -r requirements.txt
```

2. Создайте файл `.env` на основе `.env.example`:
```
cp .env.example .env
```
В Windows можно скопировать файл вручную или использовать команду:
```
copy .env.example .env
```

3. Отредактируйте файл `.env`, указав правильные учетные данные для исходной и целевой баз данных PostgreSQL.

## Структура проекта

- `main.py` - Главный файл для запуска программы конвертации
- `db_connection.py` - Модуль для подключения к исходной и целевой базам данных
- `test_connection.py` - Модуль для тестирования соединения с базой данных
- `convertor.py` - Основной модуль конвертации данных
- `dictionaries.py` - Модуль для создания и обновления словарей данных
- `insert_data.py` - Модуль для вставки данных в целевую базу данных
- `table_definitions.py` - Модуль с определениями структур таблиц
- `create_tables.py` - Модуль для создания таблиц в целевой базе данных
- `drop_tables.py` - Модуль для удаления таблиц из целевой базы данных
- `utils.py` - Вспомогательные функции для отображения данных
- `.env` - Файл с учетными данными для подключения к базам данных
- `.env.example` - Пример файла с учетными данными
- `requirements.txt` - Файл с зависимостями проекта

## Использование

### Запуск программы конвертации

Для запуска основной программы выполните:
```
python main.py
```

Программа выполнит следующие действия:
1. Проверит соединение с базами данных
2. Удалит существующие таблицы в целевой базе данных
3. Создаст таблицы согласно определениям в `table_definitions.py`
4. Создаст словари данных из исходной базы данных
5. Обновит словари данных дополнительной информацией
6. Вставит данные в таблицы целевой базы данных

### Тестирование подключения

Для тестирования только подключения к базе данных запустите:
```
python db_connection.py
```

### Структура таблиц

В проекте используются следующие таблицы:

1. `localities` - Таблица населенных пунктов:
   - id - Уникальный идентификатор записи
   - objectid - Идентификатор объекта из исходной базы данных
   - name - Название населенного пункта
   - typename - Тип населенного пункта

2. `streets` - Таблица улиц:
   - id - Уникальный идентификатор записи
   - locality_id - Идентификатор населенного пункта
   - objectid - Идентификатор объекта из исходной базы данных
   - name - Название улицы
   - typename - Тип улицы

3. `buildings` - Таблица зданий:
   - id - Уникальный идентификатор записи
   - street_id - Идентификатор улицы
   - objectid - Идентификатор объекта из исходной базы данных
   - number - Номер дома
   - add_num1 - Дополнительный номер 1
   - add_num2 - Дополнительный номер 2
   - type - Тип дома
   - add_type1 - Тип дополнительного номера 1
   - add_type2 - Тип дополнительного номера 2

## Расширение проекта

Для добавления новой таблицы в базу данных:

1. Добавьте определение таблицы в `table_definitions.py`:
```python
TABLE_DEFINITIONS['new_table'] = """
    CREATE TABLE new_table (
        id SERIAL PRIMARY KEY,
        field1 VARCHAR(100) NOT NULL,
        field2 INTEGER
    );
"""
```

2. Добавьте имя таблицы в список `ALL_TABLES` в правильном порядке создания:
```python
ALL_TABLES = ['localities', 'streets', 'buildings', 'new_table']
```

3. Создайте функцию для обновления словаря данных в `dictionaries.py`:
```python
def update_new_table_dictionary(source_cursor, dictionary_new_table):
    # Ваш код для обновления словаря
    return dictionary_new_table
```

4. Создайте функцию для вставки данных в `insert_data.py`:
```python
def insert_new_table_data(target_cursor, dictionary_new_table):
    # Ваш код для вставки данных
    return True
```

5. Обновите функцию `convertor()` в `convertor.py`, добавив вызовы новых функций.

После этого таблица будет автоматически создаваться и заполняться данными вместе с остальными таблицами.

## Настройка параметров

В файле `.env` можно настроить следующие параметры:

- `SOURCE_DB_HOST` - Хост исходной базы данных
- `SOURCE_DB_PORT` - Порт исходной базы данных
- `SOURCE_DB_NAME` - Имя исходной базы данных
- `SOURCE_DB_USER` - Пользователь исходной базы данных
- `SOURCE_DB_PASSWORD` - Пароль исходной базы данных

- `TARGET_DB_HOST` - Хост целевой базы данных
- `TARGET_DB_PORT` - Порт целевой базы данных
- `TARGET_DB_NAME` - Имя целевой базы данных
- `TARGET_DB_USER` - Пользователь целевой базы данных
- `TARGET_DB_PASSWORD` - Пароль целевой базы данных

- `BASE_PATH` - Базовый путь для фильтрации данных в исходной базе данных 